<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>页面缩放与浏览器检测示例</title>
  <style>
    /* 可选：基本样式，以便于观察页面缩放效果 */
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .content {
      background-color: lightblue;
      padding: 50px;
      text-align: center;
    }
  </style>
</head>

<body>

  <div class="content">
    <h1>欢迎来到我的页面</h1>
    <p id="browserInfo"></p>
    <p id="queryParam"></p>
    <p id="pageCheck"></p>
  </div>

  <script>
    const Browser_Type = {
      EDGE: 'EDGE',
      FIREFOX: 'FIREFOX',
      CHROME: 'CHROME',
      SAFARI: 'SAFARI',
      IE: 'IE',
      OTHER: 'OTHER',
    };

    function setScale(fn = () => { }) {
      const isPC = isPcBrowser();
      if (!isPC) {
        return;
      }
      var tid = null;
      var frameWidth = 1300;
      var scaleThreshold = 1220;
      var deviceWidth = window.innerWidth;
      let scaleX = deviceWidth / frameWidth;
      scaleX = scaleX.toFixed(3);
      document.documentElement.style = '';
      if (deviceWidth < scaleThreshold) {
        document.documentElement.style.width = frameWidth + 'px';
        document.documentElement.style.transform = `scale(${scaleX})`;
        document.documentElement.style.height = '100%';
        document.documentElement.style.transformOrigin = '0 0';
        document.documentElement.style.overflowX = 'hidden';
        document.documentElement.style.margin = '0 auto';
        fn();
      }
      window.addEventListener(
        'resize',
        function () {
          if (tid) clearTimeout(tid);
          tid = setTimeout(setScale.bind(null, fn), 300);
        },
        false,
      );
    }

    function getBrowserType(userAgent) {
      let _browser = Browser_Type.OTHER;
      if (userAgent.match(/edge\/([\d.]+)/)) _browser = Browser_Type.EDGE;
      else if (userAgent.match(/firefox\/([\d.]+)/)) _browser = Browser_Type.FIREFOX;
      else if (userAgent.match(/chrome\/([\d.]+)/)) _browser = Browser_Type.CHROME;
      else if (userAgent.match(/version\/([\d.]+).*safari/)) _browser = Browser_Type.SAFARI;
      return _browser;
    }

    function getUrlQueryStr(url, name) {
      let result;
      if (url) result = url.match(new RegExp(`[?&]${name}=([^&]+)`, 'i'));
      return result ? decodeURIComponent(result[1]) : '';
    }

    function isPerferencePage() {
      const targetRoute = getUrlQueryStr(window.location.href, 'targetRoute');
      const pathname = window.location.pathname || '';
      return pathname.includes('/portal/activity/') && targetRoute === 'myPreference';
    }

    function isBlackList() {
      return isPerferencePage();
    }

    function isPcBrowser() {
      const userAgent = typeof navigator !== 'undefined' ? navigator.userAgent.toLowerCase() : '';
      const browser = getBrowserType(userAgent);
      const isPcUA = [Browser_Type.CHROME, Browser_Type.EDGE, Browser_Type.SAFARI, Browser_Type.FIREFOX].includes(browser);
      const isWindow = /windows|macintosh/.test(userAgent);
      const isNotIframe = window.self === window.top;
      const isInBlackList = isBlackList();
      return isWindow && isPcUA && isNotIframe && !isInBlackList;
    }

    // 页面加载完成后执行
    document.addEventListener("DOMContentLoaded", function () {
      // 设置页面缩放
      setScale(() => {
        console.log("页面缩放设置完成");
      });

      // // 显示浏览器类型
      // document.getElementById("browserInfo").innerText = `您的浏览器类型是: ${getBrowserType(navigator.userAgent)}`;

      // // 获取并显示URL查询参数
      // const queryParamValue = getUrlQueryStr(window.location.href, 'example');
      // document.getElementById("queryParam").innerText = `查询参数 'example' 的值为: ${queryParamValue}`;

      // // 检查页面是否为偏好设置页
      // document.getElementById("pageCheck").innerText = isPerferencePage() ? "当前页面是偏好设置页" : "当前页面不是偏好设置页";
    });
  </script>

</body>

</html>